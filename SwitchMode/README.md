# Switch Mode
When an 8bitdo controller is impersonating a Switch Pro controller, it is unable to be managed.  In order for a manager to detect if a Switch Pro controller is actually an 8bitdo controller, a version request is sent to any device which appears to be a Switch Pro controller.  An 8bitdo controller in Switch mode will respond, containing the PID of the 8bitdo controller.  Once a Switch Pro controller is determined to be an 8bitdo controller, a change mode command is used to switch the controller into DInput mode, in which the controller is identified as an 8bitdo controller, using an 8bitdo VID.  At this point, normal manager commands and requests can be used.

## Version Request
The version request is six bytes written directly to the HID virtual file, in hex format as `01 66 AA 00 21 01`.  This request must be sent repeatedly until the version data read from the HID virtual file is in the correct format.  In testing, this always works at least by the second try.  When the version data is in the proper format, the first three bytes in hex format are `81 66 A5`, the next two bytes are the PID of the device in big endian format, the next byte appears to be hex format `22`, and the remaining 58 bytes are not known, but might possibly be related to firmware version.  In my testing, an SN30 Pro+ (PID 0x6002) returned `F8 01 00 00 01 01`, and a Pro2 (PID 0x6003) returned `6C`.

## Switch to 8bitdo mode
The change mode command is six bytes written directly to the HID virtual file, in hex format as `01 66 AA 00 51 01`.  This will cause the controller to reconnect to the host device as an 8bitdo controller, using the same VID and PID as if the controller were in DInput mode when connecting to the host.  In testing with both the SN30 Pro+ (0x6002) and Pro2 (0x6003), sending the command one time causes the controller to switch modes, and the HID virtual file is closed and deleted before having a chance to read from the file.

## Scripts
The scripts found in this folder can be used to obtain version information as well as to change the controller into 8bitdo mode so that the controller can be managed by an 8bitdo controller manager.  The path to the proper `/dev/hidraw*` must be passed to the script for it to function properly, as example, `./swGetVer.sh /dev/hidraw0`.  Ensure that the `hidraw` file being passed is the correct file, as sending data to a different device may have unpredictable results.  Also, the `hid_nintendo` module may not properly create the `hidraw` file, as 8bitdo controllers in Switch mode has been known not to load properly with this module, and may require either unloading or blacklisting the module in order for the `hidraw` file to be created.  The scripts depend on bash (or compatible shell host) to execute and the `swGetVer.sh` script requires the `hexdump` utility (or compatible alias) be available.